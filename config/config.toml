# Prism RPC Aggregator Configuration - Production
# This configuration is optimized for production deployments with JSON logging
# and production-ready settings.
#
# For development, use: PRISM_CONFIG=config/development.toml cargo run --bin server
# For production, use the default config/config.toml (this file)

environment = "production"

[server]
bind_address = "0.0.0.0"
bind_port = 3030
max_concurrent_requests = 500
request_timeout_seconds = 30

# Configure your RPC providers here
# These are example public endpoints - replace with your own for production
[upstreams]
[[upstreams.providers]]
name = "mevblocker"
chain_id = 1
https_url = "https://rpc.mevblocker.io/fast"
wss_url = "wss://rpc.mevblocker.io/fast"
weight = 1
timeout_seconds = 30
circuit_breaker_threshold = 3
circuit_breaker_timeout_seconds = 30

[[upstreams.providers]]
name = "publicnode"
chain_id = 1
https_url = "https://ethereum-rpc.publicnode.com"
wss_url = "wss://ethereum-rpc.publicnode.com"
weight = 1
timeout_seconds = 30
circuit_breaker_threshold = 3
circuit_breaker_timeout_seconds = 30

[[upstreams.providers]]
name = "tenderly"
chain_id = 1
https_url = "https://mainnet.gateway.tenderly.co"
wss_url = "wss://mainnet.gateway.tenderly.co"
weight = 1
timeout_seconds = 30
circuit_breaker_threshold = 3
circuit_breaker_timeout_seconds = 30

[[upstreams.providers]]
name = "drpc"
chain_id = 1
https_url = "https://eth.drpc.org"
wss_url = "wss://eth.drpc.org"
weight = 1
timeout_seconds = 30
circuit_breaker_threshold = 3
circuit_breaker_timeout_seconds = 30

[cache]
enabled = true
cache_ttl_seconds = 300

[cache.manager_config]
retain_blocks = 1000
enable_auto_cleanup = true
cleanup_interval_seconds = 300  # 5 minutes
cleanup_every_n_blocks = 100    # Trigger cleanup every 100 blocks

[cache.manager_config.log_cache]
chunk_size = 1000
max_exact_results = 10000
max_bitmap_entries = 100000
safety_depth = 12

[cache.manager_config.block_cache]
hot_window_size = 200
max_headers = 10000
max_bodies = 10000
safety_depth = 12

[cache.manager_config.transaction_cache]
max_transactions = 50000
max_receipts = 50000
safety_depth = 12

[cache.manager_config.reorg_manager]
safety_depth = 64
max_reorg_depth = 256
reorg_detection_threshold = 3

[health_check]
interval_seconds = 60

[auth]
enabled = true
database_url = "sqlite://db/auth.db"

[metrics]
enabled = true
prometheus_port = 9090

[logging]
level = "info"
format = "json"
