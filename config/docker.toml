# =============================================================================
# Prism RPC Aggregator - Docker Configuration
# =============================================================================
#
# This configuration is optimized for Docker container deployments.
# Key differences from the default config:
#   - bind_address = "0.0.0.0" (listen on all interfaces)
#   - JSON logging format for container log aggregation
#   - Paths optimized for container filesystem layout
#
# Usage:
#   docker run -v ./docker.toml:/app/config/config.toml:ro ...
#
# Environment variable overrides supported via config crate.
# =============================================================================

environment = "production"

[server]
# IMPORTANT: Use 0.0.0.0 to listen on all interfaces in containers
bind_address = "0.0.0.0"
bind_port = 3030
max_concurrent_requests = 500
request_timeout_seconds = 30

# =============================================================================
# Upstream RPC Providers
# =============================================================================
# Configure your actual RPC endpoints here.
# These public endpoints are for demonstration only - replace with your own.
# =============================================================================

[upstreams]

[[upstreams.providers]]
name = "primary"
chain_id = 1
# Replace with your actual RPC endpoint
https_url = "https://eth-mainnet.your-provider.com/YOUR_API_KEY"
# Optional: WebSocket for chain tip tracking
wss_url = "wss://eth-mainnet.your-provider.com/YOUR_API_KEY"
weight = 2
timeout_seconds = 30
circuit_breaker_threshold = 3
circuit_breaker_timeout_seconds = 30

[[upstreams.providers]]
name = "fallback"
chain_id = 1
https_url = "https://eth-mainnet.backup-provider.com/YOUR_API_KEY"
wss_url = "wss://eth-mainnet.backup-provider.com/YOUR_API_KEY"
weight = 1
timeout_seconds = 30
circuit_breaker_threshold = 3
circuit_breaker_timeout_seconds = 30

# =============================================================================
# Caching Configuration
# =============================================================================

[cache]
enabled = true
cache_ttl_seconds = 300

[cache.manager_config]
retain_blocks = 2000
enable_auto_cleanup = true
cleanup_interval_seconds = 300
cleanup_every_n_blocks = 100

[cache.manager_config.log_cache]
chunk_size = 1000
max_exact_results = 20000
max_bitmap_entries = 200000
safety_depth = 12

[cache.manager_config.block_cache]
hot_window_size = 200
max_headers = 20000
max_bodies = 20000
safety_depth = 12

[cache.manager_config.transaction_cache]
max_transactions = 100000
max_receipts = 100000
safety_depth = 12

[cache.manager_config.reorg_manager]
safety_depth = 64
max_reorg_depth = 256
reorg_detection_threshold = 3

# =============================================================================
# Health Check Configuration
# =============================================================================

[health_check]
interval_seconds = 60

# =============================================================================
# Authentication Configuration
# =============================================================================
# When enabled, API key authentication is required.
# Database is stored in a Docker volume for persistence.

[auth]
enabled = true
# Path inside the container - mount a volume to /app/db
database_url = "sqlite:///app/db/auth.db"

# =============================================================================
# Metrics Configuration
# =============================================================================

[metrics]
enabled = true
prometheus_port = 9090

# =============================================================================
# Logging Configuration
# =============================================================================
# JSON format is recommended for Docker deployments.
# Enables structured logging for log aggregation tools (Loki, ELK, etc.)

[logging]
level = "info"
format = "json"
